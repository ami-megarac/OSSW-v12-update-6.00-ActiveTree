diff -Naur linux_ori/fs/overlayfs/copy_up.c linux/fs/overlayfs/copy_up.c
--- linux_ori/fs/overlayfs/copy_up.c	2023-05-09 18:39:06.016260931 +0800
+++ linux/fs/overlayfs/copy_up.c	2023-05-09 18:38:22.675411000 +0800
@@ -806,6 +806,10 @@
 	if (err)
 		return err;
 
+	if (!kuid_has_mapping(current_user_ns(), ctx.stat.uid) ||
+	    !kgid_has_mapping(current_user_ns(), ctx.stat.gid))
+		return -EOVERFLOW;
+
 	ctx.metacopy = ovl_need_meta_copy_up(dentry, ctx.stat.mode, flags);
 
 	if (parent) {
