diff -Naur linux_ori/kernel/bpf/verifier.c linux/kernel/bpf/verifier.c
--- linux_ori/kernel/bpf/verifier.c	2023-03-13 17:18:25.000000000 +0800
+++ linux/kernel/bpf/verifier.c	2023-10-11 11:34:01.918964428 +0800
@@ -1563,6 +1563,21 @@
 			}
 		} else if (opcode == BPF_EXIT) {
 			return -ENOTSUPP;
+		} else if (BPF_SRC(insn->code) == BPF_X) {
+			if (!(*reg_mask & (dreg | sreg)))
+				return 0;
+			/* dreg <cond> sreg
+			 * Both dreg and sreg need precision before
+			 * this insn. If only sreg was marked precise
+			 * before it would be equally necessary to
+			 * propagate it to dreg.
+			 */
+			*reg_mask |= (sreg | dreg);
+			 /* else dreg <cond> K
+			  * Only dreg still needs precision before
+			  * this insn, so for the K-based conditional
+			  * there is nothing new to be marked.
+			  */
 		}
 	} else if (class == BPF_LD) {
 		if (!(*reg_mask & dreg))
