--- linux_patch108/net/netfilter/nfnetlink_queue.c	2022-09-01 11:28:23.132563615 +0800
+++ linux/net/netfilter/nfnetlink_queue.c	2022-09-01 11:46:59.643398071 +0800
@@ -839,11 +839,16 @@
 }
 
 static int
-nfqnl_mangle(void *data, int data_len, struct nf_queue_entry *e, int diff)
+nfqnl_mangle(void *data, unsigned int data_len, struct nf_queue_entry *e, int diff)
 {
 	struct sk_buff *nskb;
 
 	if (diff < 0) {
+		unsigned int min_len = skb_transport_offset(e->skb);
+
+		if (data_len < min_len)
+			return -EINVAL;
+
 		if (pskb_trim(e->skb, data_len))
 			return -ENOMEM;
 	} else if (diff > 0) {
