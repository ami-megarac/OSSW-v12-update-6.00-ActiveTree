diff -Naru linux_origin/fs/file.c linux/fs/file.c
--- linux_origin/fs/file.c	2021-12-30 10:40:41.215352210 +0800
+++ linux/fs/file.c	2021-12-30 15:25:56.008341561 +0800
@@ -723,6 +723,10 @@
 			file = NULL;
 		else if (!get_file_rcu_many(file, refs))
 			goto loop;
+		else if (__fcheck_files(files, fd) != file) {
+			fput_many(file, refs);
+			goto loop;
+		}
 	}
 	rcu_read_unlock();
 
