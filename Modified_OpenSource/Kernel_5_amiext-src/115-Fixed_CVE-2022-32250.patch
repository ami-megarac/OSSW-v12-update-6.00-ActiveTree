diff -Naur linux_org/net/netfilter/nf_tables_api.c linux/net/netfilter/nf_tables_api.c
--- linux_org/net/netfilter/nf_tables_api.c	2021-10-20 17:40:18.000000000 +0800
+++ linux/net/netfilter/nf_tables_api.c	2022-10-20 16:18:15.382816317 +0800
@@ -2267,27 +2267,31 @@
 
 	err = nf_tables_expr_parse(ctx, nla, &info);
 	if (err < 0)
-		goto err1;
+		goto err_expr_parse;
+
+	err = -EOPNOTSUPP;
+	if (!(info.ops->type->flags & NFT_EXPR_STATEFUL))
+		goto err_expr_stateful;
 
 	err = -ENOMEM;
 	expr = kzalloc(info.ops->size, GFP_KERNEL);
 	if (expr == NULL)
-		goto err2;
+		goto err_expr_stateful;
 
 	err = nf_tables_newexpr(ctx, &info, expr);
 	if (err < 0)
-		goto err3;
+		goto err_expr_new;
 
 	return expr;
-err3:
+err_expr_new:
 	kfree(expr);
-err2:
+err_expr_stateful:
 	owner = info.ops->type->owner;
 	if (info.ops->type->release_ops)
 		info.ops->type->release_ops(info.ops);
 
 	module_put(owner);
-err1:
+err_expr_parse:
 	return ERR_PTR(err);
 }
 
diff -Naur linux_org/net/netfilter/nft_dynset.c linux/net/netfilter/nft_dynset.c
--- linux_org/net/netfilter/nft_dynset.c	2021-10-20 17:40:18.000000000 +0800
+++ linux/net/netfilter/nft_dynset.c	2022-10-20 16:18:14.082839507 +0800
@@ -213,8 +213,6 @@
 			return PTR_ERR(priv->expr);
 
 		err = -EOPNOTSUPP;
-		if (!(priv->expr->ops->type->flags & NFT_EXPR_STATEFUL))
-			goto err1;
 
 		if (priv->expr->ops->type->flags & NFT_EXPR_GC) {
 			if (set->flags & NFT_SET_TIMEOUT)
